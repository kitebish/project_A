name: Cursor Files Safety Check

on:
  push:
    branches: ["**"]
  pull_request:
    branches: ["**"]

jobs:
  check-cursor-files:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Check for Cursor configuration files
        run: |
          echo "Checking for Cursor files..."

          # Check current files
          if find . -path ./.git -prune -o \( -name ".cursor" -o -name ".cursorrules" -o -name "*.mdc" \) -print | grep -q .; then
            echo "ERROR: Cursor configuration files found in repository"
            echo "Files found:"
            find . -path ./.git -prune -o \( -name ".cursor" -o -name ".cursorrules" -o -name "*.mdc" \) -print
            exit 1
          fi

          # Check Git history
          if git log --all --name-only --pretty=format: | grep -qE '\.cursor/|\.cursorrules$|\.mdc$'; then
            echo "ERROR: Cursor files found in Git history"
            echo "Files in history:"
            git log --all --name-only --pretty=format: | grep -E '\.cursor/|\.cursorrules$|\.mdc$' | sort -u
            exit 1
          fi

          echo "No Cursor files detected - PASS"
